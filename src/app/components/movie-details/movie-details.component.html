<div class="container">

    @if (movie) {
        <div class="movie-container">
            <div class="movie-details">
                <div class="movie-poster" (click)="openPosterModal()">
                    <img src="{{movie.posterPath}}" alt="{{movie.title}}">
                </div>

                <div class="movie-info">
                    <h1 class="movie-title">
                        {{ movie.title }}
                        <span>({{ movie.startDate | date:'yyyy' }})</span>
                    </h1>
                    <div class="movie-summary">
                        <span>{{ movie.startDate | date:'dd.MM.yyyy' }}</span>
                        <span class="dot"></span>
                        <span>{{ movie.genres.join(', ') }}</span>
                        <span class="dot"></span>
                        <span>{{ formatDuration(movie.duration) }}</span>
                        <span class="dot"></span>
                        <span>{{ movie.technologies[0] }}</span>
                    </div>
                    <p class="movie-description">{{ movie.description }}</p>
                    <div class="movie-credits">
                        <p class="movie-actors">
                            Glumci:
                            <br>
                            <span>{{ movie.actors.join(', ') }}</span>
                        </p>
                        <p class="movie-directors">
                            Režiseri:
                            <br>
                            <span>{{ movie.directors.join(', ') }}</span>
                        </p>
                        <p class="movie-distributor">
                            Distributor:
                            <br>
                            <span>{{ movie.distributorName }}</span>
                        </p>
                    </div>
                    <div class="movie-actions">
                        <button mat-flat-button class="cart-button">
                            <mat-icon fontIcon="shopping_cart"/> Dodaj u korpu
                        </button>
                        <button mat-flat-button class="trailer-button">
                            <mat-icon fontIcon="movie"/> Pogledaj trailer
                        </button>
                    </div>
                </div>
            </div>

            <div class="movie-gallery">
                <button class="gallery-arrow left" (click)="prevImage()">&#10094;</button>
                <div class="gallery-track" #galleryContainer>

                    @for (image of movie.gallery; track image; let idx = $index) {
                        <img [src]="image" alt="Gallery Image" (click)="openGalleryDialog(idx)">
                    }

                </div>
                <button class="gallery-arrow right" (click)="nextImage()">&#10095;</button>
            </div>

            <div class="movie-reviews">
                <!-- Average Rating -->
                <div class="average-rating">
                    <span class="rating-score">{{ averageRating }} / 5</span>
                    <div class="stars">
                        <mat-icon *ngFor="let star of [1, 2, 3, 4, 5]" [class.filled]="star <= averageRating">star</mat-icon>
                    </div>
                    <p class="review-count">{{ totalReviews }} recenzija</p>
                </div>

                <!-- Rating Breakdown -->
                <div class="rating-breakdown">
                    <div class="rating-row" *ngFor="let star of [5, 4, 3, 2, 1]; let i = index">
                        <span>{{ star }} <mat-icon class="star-icon">star</mat-icon></span>
                        <div class="rating-bar">
                            <div class="bar-fill" [style.width.%]="(ratingCounts[i] / (totalReviews || 1)) * 100"></div>
                        </div>
                        <span class="review-count">({{ ratingCounts[i] }})</span>
                    </div>
                </div>

                <!-- Review Button -->
                <button mat-raised-button color="primary">Napravite recenziju</button>

                <!-- Filters -->
                <div class="filters">
                    <mat-select placeholder="Prikazi sve">
                        <mat-option value="all">Prikazi sve</mat-option>
                    </mat-select>

                    <mat-select placeholder="Sortiraj po datumu (starije)">
                        <mat-option value="oldest">Sortiraj po datumu (starije)</mat-option>
                        <mat-option value="newest">Sortiraj po datumu (novije)</mat-option>
                    </mat-select>
                </div>

                <!-- No Reviews Message -->
                <p class="no-reviews" *ngIf="totalReviews === 0">Nisu pronađene recenzije!</p>
            </div>
        </div>
    }

    @if (!movie) {
        <app-loading/>
    }
</div>
